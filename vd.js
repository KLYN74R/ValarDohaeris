/*



                                                                                                                                                                                                                               
                                                                                                                                                                                                                               
VVVVVVVV           VVVVVVVV               lllllll                                    DDDDDDDDDDDDD                        hhhhhhh                                                                       iiii                   
V::::::V           V::::::V               l:::::l                                    D::::::::::::DDD                     h:::::h                                                                      i::::i                  
V::::::V           V::::::V               l:::::l                                    D:::::::::::::::DD                   h:::::h                                                                       iiii                   
V::::::V           V::::::V               l:::::l                                    DDD:::::DDDDD:::::D                  h:::::h                                                                                              
 V:::::V           V:::::Vaaaaaaaaaaaaa    l::::l   aaaaaaaaaaaaa  rrrrr   rrrrrrrrr   D:::::D    D:::::D    ooooooooooo   h::::h hhhhh         aaaaaaaaaaaaa      eeeeeeeeeeee    rrrrr   rrrrrrrrr  iiiiiii     ssssssssss   
  V:::::V         V:::::V a::::::::::::a   l::::l   a::::::::::::a r::::rrr:::::::::r  D:::::D     D:::::D oo:::::::::::oo h::::hh:::::hhh      a::::::::::::a   ee::::::::::::ee  r::::rrr:::::::::r i:::::i   ss::::::::::s  
   V:::::V       V:::::V  aaaaaaaaa:::::a  l::::l   aaaaaaaaa:::::ar:::::::::::::::::r D:::::D     D:::::Do:::::::::::::::oh::::::::::::::hh    aaaaaaaaa:::::a e::::::eeeee:::::eer:::::::::::::::::r i::::i ss:::::::::::::s 
    V:::::V     V:::::V            a::::a  l::::l            a::::arr::::::rrrrr::::::rD:::::D     D:::::Do:::::ooooo:::::oh:::::::hhh::::::h            a::::ae::::::e     e:::::err::::::rrrrr::::::ri::::i s::::::ssss:::::s
     V:::::V   V:::::V      aaaaaaa:::::a  l::::l     aaaaaaa:::::a r:::::r     r:::::rD:::::D     D:::::Do::::o     o::::oh::::::h   h::::::h    aaaaaaa:::::ae:::::::eeeee::::::e r:::::r     r:::::ri::::i  s:::::s  ssssss 
      V:::::V V:::::V     aa::::::::::::a  l::::l   aa::::::::::::a r:::::r     rrrrrrrD:::::D     D:::::Do::::o     o::::oh:::::h     h:::::h  aa::::::::::::ae:::::::::::::::::e  r:::::r     rrrrrrri::::i    s::::::s      
       V:::::V:::::V     a::::aaaa::::::a  l::::l  a::::aaaa::::::a r:::::r            D:::::D     D:::::Do::::o     o::::oh:::::h     h:::::h a::::aaaa::::::ae::::::eeeeeeeeeee   r:::::r            i::::i       s::::::s   
        V:::::::::V     a::::a    a:::::a  l::::l a::::a    a:::::a r:::::r            D:::::D    D:::::D o::::o     o::::oh:::::h     h:::::ha::::a    a:::::ae:::::::e            r:::::r            i::::i ssssss   s:::::s 
         V:::::::V      a::::a    a:::::a l::::::la::::a    a:::::a r:::::r          DDD:::::DDDDD:::::D  o:::::ooooo:::::oh:::::h     h:::::ha::::a    a:::::ae::::::::e           r:::::r           i::::::is:::::ssss::::::s
          V:::::V       a:::::aaaa::::::a l::::::la:::::aaaa::::::a r:::::r          D:::::::::::::::DD   o:::::::::::::::oh:::::h     h:::::ha:::::aaaa::::::a e::::::::eeeeeeee   r:::::r           i::::::is::::::::::::::s 
           V:::V         a::::::::::aa:::al::::::l a::::::::::aa:::ar:::::r          D::::::::::::DDD      oo:::::::::::oo h:::::h     h:::::h a::::::::::aa:::a ee:::::::::::::e   r:::::r           i::::::i s:::::::::::ss  
            VVV           aaaaaaaaaa  aaaallllllll  aaaaaaaaaa  aaaarrrrrrr          DDDDDDDDDDDDD           ooooooooooo   hhhhhhh     hhhhhhh  aaaaaaaaaa  aaaa   eeeeeeeeeeeeee   rrrrrrr           iiiiiiii  sssssssssss    
                                                                                                                                                                                                                               
                                                                                                                                                                                                                               
                                                                                                                                                                                                                               
                                                                                                                                                                                                                               
                                                                                                                                                                                                                               
                                                                                                                                                                                                                               
                                                                    
                                                                                                                                                         
88                           88      a8P   88                                                       888888888888                                         
88                           88    ,88'    88                             ,d                             88                                              
88                           88  ,88"      88                             88                             88                                              
88,dPPYba,   8b       d8     88,d88'       88  8b       d8  8b,dPPYba,  MM88MMM  ,adPPYYba,  8b,dPPYba,  88   ,adPPYba,  ,adPPYYba,  88,dPYba,,adPYba,   
88P'    "8a  `8b     d8'     8888"88,      88  `8b     d8'  88P'   `"8a   88     ""     `Y8  88P'   "Y8  88  a8P_____88  ""     `Y8  88P'   "88"    "8a  
88       d8   `8b   d8'      88P   Y8b     88   `8b   d8'   88       88   88     ,adPPPPP88  88          88  8PP"""""""  ,adPPPPP88  88      88      88  
88b,   ,a8"    `8b,d8'       88     "88,   88    `8b,d8'    88       88   88,    88,    ,88  88          88  "8b,   ,aa  88,    ,88  88      88      88  
8Y"Ybbd8"'       Y88'        88       Y8b  88      Y88'     88       88   "Y888  `"8bbdP"Y8  88          88   `"Ybbd8"'  `"8bbdP"Y8  88      88      88  
                 d8'                               d8'                                                                                                   
                d8'                               d8'                                                                                                    



CREATOR: VLad Chernenko
GitHub:https://github.com/VladChernenko
Organization:https://github.com/VladChernenko



@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@                                                      @
@     Created for ValarDohaeris release for Klyntar    @
@                                                      @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@



____________________________________________________________Description____________________________________________________________

Useful module to work with different cryptocurrecies

Prepared following GSVDT scheme

G-Generate
S-Sign
V-Verify
D-Derive(keypair from private,seed,etc.)
T-Transfer(transfer everything you need to verify signature)


*/



import {crypto as bnbcrypto} from '@binance-chain/javascript-sdk'
import {FilecoinSigner} from '@blitslabs/filecoin-js-signer'
import {Keypair} from 'stellar-sdk'
import rip from 'ripple-keypairs'
import algosdk from 'algosdk'
import crypto from 'crypto'
import Web3 from 'web3'



let filecoin_signer = new FilecoinSigner(),
    
    web3=new Web3()








export default {

    // XPR GSVDT scheme
    XRP:{

        generate:seedOptions=>{
            
            let seed=rip.generateSeed(seedOptions),
                
                keyPair=rip.deriveKeypair(seed)

            return {seed,keyPair,address:rip.deriveAddress(keyPair.publicKey)}

        },

        sign:(stringData,privateKey)=>rip.sign(stringData,privateKey),

        verify:(plainText,signature,publicKey)=>rip.verify(plainText,signature,publicKey)

    },




    //KLYNTAR native format
    KLYNTAR:{


        generate:()=>new Promise((resolve,reject)=>{

            crypto.generateKeyPair('ed25519',{
                
                namedCurve: 'secp256k1',
                publicKeyEncoding: {type: 'spki',format: 'der'},
                privateKeyEncoding: {type: 'pkcs8',format: 'der'}
             
            },(err, publicKey, privateKey)=>err?reject(false):resolve({pub:publicKey.toString('base64').slice(16),prv:privateKey.toString('base64')}))
        
        }).catch(e=>false),



        sign:(data,privateKey)=>new Promise((resolve,reject)=>

            crypto.sign(null,Buffer.from(data),'-----BEGIN PRIVATE KEY-----\n'+privateKey+'\n-----END PRIVATE KEY-----',(e,sig)=>
     
                e?reject(''):resolve(sig.toString('base64'))
    
            )
    
        ).catch(e=>''),

       

        verify:(data,signature,pubKey)=>new Promise((resolve,reject)=>

            //Add mandatory prefix and postfix to pubkey
            crypto.verify(null,data,'-----BEGIN PUBLIC KEY-----\n'+'MCowBQYDK2VwAyEA'+pubKey+'\n-----END PUBLIC KEY-----',Buffer.from(signature,'base64'),(e,res)=>
        
                e?reject(false):resolve(res)
        
            )
       
       ).catch(e=>false)

    },





    //For EVM chains which supports such format
    //!Change output data(minimization)
    ETH_LIKE:{

        generate:()=>{
            
            let {address,privateKey}=web3.eth.accounts.create()
            
            return {address,privateKey}
        
        },

        sign:(data,privateKey)=>web3.eth.accounts.sign(data,privateKey),

        verify:(signature,address)=>web3.eth.accounts.recover(signature)===address

    },




    ALGORAND:{

        generate:()=>{
            
            let acc=algosdk.generateAccount()

            return {acc,mnemonic:algosdk.secretKeyToMnemonic(acc.sk)}
        
        },
        
        sign:(data,privateKey)=>Buffer.from(algosdk.signBytes(Buffer.from(data),privateKey)).toString('base64'),
        
        verify:(data,signature,address)=>algosdk.verifyBytes(Buffer.from(data),Buffer.from(signature,'base64'),address),
        
        deriveAccFromMnemonic:phrase=>algosdk.mnemonicToSecretKey(phrase)

    },



    
    FILECOIN:{

        generate:async(mnemonicBitsStrength,network,derivationPath=`m/44'/461'/0'/0/0`)=>{

            let mnemonic = await filecoin_signer.wallet.generateMnemonic(mnemonicBitsStrength),

                keyPair = await filecoin_signer.wallet.keyDerive(mnemonic,derivationPath,network)


            return {mnemonic,keyPair}

        },

        
        /**
        *   To sign random string data
        *
        *   @param {string} data String data to sign
        *   @param {string} privateKey  32-bytes hexadecimal privateKey
        * 
        *   @returns {Promise<String>}
        */
        sign:(data,privateKey)=>filecoin_signer.utils.signMessage(data, privateKey),


        /**
        *   To verify random string data
        *
        *   @param {string} data String data to sign
        *   @param {string} signature  64-bytes hexadeciml signature
        *   @param {string} address Address of signer
        *   @returns {Promise<boolean>} Is valid signature?
        */
        verify:(data,signature,address)=>filecoin_signer.utils.verifySignature(data,signature,address)

    },



    BINANCE_CHAIN:{


        generateMnemonic:()=>bnbcrypto.generateMnemonic(),

        generate:mnemonic=>{
            
            // generate key entropy
            let privateKey = mnemonic ? bnbcrypto.getPrivateKeyFromMnemonic(mnemonic) : bnbcrypto.generatePrivateKey(),
    
                // get an address
                address = bnbcrypto.getAddressFromPrivateKey(privateKey,'bnb'),

                publicKey = bnbcrypto.getPublicKeyFromPrivateKey(privateKey)
        

            return {privateKey,address,publicKey}    
        
        },



        sign:(data,privateKey)=>Buffer.from(bnbcrypto.generateSignature(data,privateKey)).toString('base64'),


        verify:(data,signature,pubKey)=>bnbcrypto.verifySignature(Buffer.from(signature,'base64'),data,pubKey),


        deriveFromMnemonic:mnemonic=>{
            
            let privateKey=crypto.getPrivateKeyFromMnemonic(mnemonic),

                publicKey=crypto.getPublicKeyFromPrivateKey(priv),

                address=crypto.getAddressFromPublicKey(pub,'bnb')

            return {privateKey,publicKey,address}
        
        },

    }





}